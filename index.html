<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ultimate Study Dictionary & Current Affairs</title>
<!-- Font Awesome CDN for icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
<!-- Papa Parse CDN for CSV parsing -->
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Poppins&display=swap');

  * {
    box-sizing: border-box;
  }

  body, html {
    margin: 0; padding: 0;
    font-family: 'Poppins', sans-serif;
    background: #ffffff;
    color: #000000;
    height: 100vh;
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }

  header {
    background: #ffffff;
    border-bottom: 1px solid #ccc;
    color: #000;
    padding: 10px 16px;
    text-align: center;
    font-weight: 600;
    font-size: 12px;
    user-select: none;
  }
  main {
    flex: 1;
    overflow-y: auto;
    padding: 14px 12px 90px 12px;
    max-width: 900px;
    margin: auto;
    width: 100%;
  }
  /* File load button */
  #loadFileBtn {
    position: fixed;
    top: 12px;
    left: 16px;
    background: #000000;
    color: white;
    border: none;
    padding: 6px 14px;
    font-size: 12px;
    border-radius: 3px;
    user-select: none;
    cursor: pointer;
    z-index: 1103;
  }
  #loadFileBtn:hover {
    background: #222222;
  }
  #fileInput {
    display: none;
  }

  /* Bottom Navigation Bar with Minimal Black Buttons */
  footer {
    background: #ffffff;
    box-shadow: 0 -1px 5px rgba(0,0,0,0.1);
    position: fixed;
    bottom: 0;
    width: 100%;
    height: 50px;
    display: flex;
    justify-content: space-around;
    align-items: center;
    padding: 0 8px;
    z-index: 1000;
    border-top: 1px solid #ccc;
  }

  .bubble-nav {
    background-color: #000000;
    border: none;
    padding: 6px 14px;
    font-weight: 600;
    color: white;
    cursor: pointer;
    font-size: 10px;
    min-width: 70px;
    text-align: center;
    user-select: none;
    transition: background-color 0.2s ease;
    border-radius: 2px;
    letter-spacing: 0.02em;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
  }
  .bubble-nav i {
    font-size: 0.85rem;
  }
  .bubble-nav.active {
    background-color: #222222;
  }
  .bubble-nav:hover:not(.active) {
    background-color: #333333;
  }

  /* Search Bar */
  #searchBar {
    position: fixed;
    bottom: 55px;
    left: 50%;
    transform: translateX(-50%);
    width: 90%;
    max-width: 700px;
    background: white;
    border: 1px solid #000;
    padding: 6px 14px;
    display: none;
    z-index: 1050;
  }
  #searchInput {
    width: 100%;
    padding: 6px 10px;
    font-size: 10px;
    border: none;
    outline: none;
    font-weight: 600;
    letter-spacing: 0.02em;
    color: #000;
    background: #f9f9f9;
    border-radius: 3px;
    box-sizing: border-box;
  }
  #searchInput::placeholder {
    color: #666;
  }
  #searchInput:focus {
    outline: none;
    box-shadow: 0 0 6px #000000aa;
  }
  #searchToggle {
    background: #000000;
    border: none;
    cursor: pointer;
    position: fixed;
    bottom: 110px;
    right: 16px;
    z-index: 1100;
    font-size: 20px;
    color: white;
    width: 36px;
    height: 36px;
    display: flex;
    justify-content: center;
    align-items: center;
    user-select: none;
    border-radius: 3px;
    box-shadow: none;
    transition: background-color 0.2s ease;
  }
  #searchToggle:hover {
    background-color: #222222;
  }

  /* Topic List */
  #topicList {
    list-style: none;
    padding: 0;
    margin: 0 auto;
    max-width: 840px;
  }
  .topic-item {
    background: #ffffff;
    border: 1px solid #000000;
    margin-bottom: 6px;
    padding: 10px 14px;
    cursor: pointer;
    font-weight: 600;
    color: #000000;
    font-size: 10px;
    width: 100%;
    box-sizing: border-box;
    user-select: none;
    border-radius: 2px;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .topic-item i {
    font-size: 0.85rem;
    color: #000;
    flex-shrink: 0;
  }
  .topic-item:hover {
    background-color: #000000;
    color: #ffffff;
    border-color: #000000;
  }
  .topic-item:focus-visible {
    outline: 2px solid #000000;
    outline-offset: 2px;
    background-color: #222222;
    color: #fff;
  }

  /* Reading Page */
  #readingPage {
    display: none;
    max-width: 900px;
    margin: 0 auto 90px;
    background: #ffffff;
    border: 1px solid #000000;
    padding: 28px 32px;
    line-height: 1.5;
    color: #000000;
    font-size: 13px;
    border-radius: 3px;
    box-sizing: border-box;
    overflow-y: auto;
  }
  #readingPage h2 {
    color: #000000;
    margin-top: 0;
    font-size: 18px;
    font-weight: 700;
    margin-bottom: 20px;
  }
  #readingPage h3 {
    margin-top: 28px;
    margin-bottom: 12px;
    font-weight: 600;
    color: #000;
    font-size: 15px;
  }
  #readingPage ul {
    margin-left: 20px;
    margin-bottom: 24px;
    color: #111;
    font-size: 12px;
  }
  #readingPage p {
    margin-bottom: 18px;
  }
  #readingPage pre {
    background: #f0f0f0;
    padding: 12px;
    overflow-x: auto;
    border-radius: 4px;
    font-size: 11px;
    color: #111827;
    margin-bottom: 18px;
  }
  #backToTopics {
    margin-bottom: 22px;
    background: #000000;
    color: white;
    border: none;
    padding: 10px 26px;
    font-weight: 600;
    font-size: 12px;
    cursor: pointer;
    border-radius: 4px;
    user-select: none;
    transition: background-color 0.2s ease;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  #backToTopics i {
    font-size: 1rem;
  }
  #backToTopics:hover {
    background-color: #222222;
  }

  /* Current Affairs reading style */
  .current-affairs-carousel {
    max-width: 900px;
    margin: 0 auto;
    background: #ffffff;
    border: 1px solid #000000;
    padding: 28px 32px;
    color: #000000;
    min-height: 220px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    font-weight: 600;
    font-size: 13px;
    border-radius: 3px;
  }
  .carousel-title {
    font-size: 18px;
    margin-bottom: 12px;
    color: #000000;
    font-weight: 700;
  }
  .carousel-date {
    font-style: italic;
    color: #444444;
    margin-bottom: 20px;
    font-size: 12px;
  }
  .carousel-content {
    font-size: 13px;
    line-height: 1.5;
    font-weight: 600;
    color: #222222;
  }
  .no-result {
    font-weight: 600;
    font-size: 12px;
    color: #555555;
    padding: 50px 0;
    text-align: center;
  }
</style>
</head>
<body>
<button id="loadFileBtn" aria-label="Load Topics CSV"><i class="fa-solid fa-file-csv"></i> Load Topics CSV</button>
<input type="file" id="fileInput" accept=".csv,text/csv" />

<header id="appHeader" tabindex="0" aria-live="polite" aria-atomic="true">Current Affairs</header>

<main>
  <!-- Topic List Page -->
  <ul id="topicList" role="list" aria-label="Subject topics">
    <!-- Dynamic topic items -->
  </ul>

  <!-- Reading Page: detailed content with back button -->
  <section id="readingPage" tabindex="0" aria-live="polite" aria-atomic="true">
    <button id="backToTopics" aria-label="Back to topic list"><i class="fa-solid fa-arrow-left"></i> Back to Topics</button>
    <div id="readingContent">
      <!-- detailed content here -->
    </div>
  </section>
</main>

<button id="searchToggle" aria-label="Toggle Search" title="Search"><i class="fa-solid fa-magnifying-glass"></i></button>
<div id="searchBar" role="search">
  <input type="search" id="searchInput" placeholder="Search notes and topics..." aria-label="Search notes and topics" autocomplete="off" />
</div>

<footer role="tablist" aria-label="Primary subjects navigation">
  <button class="bubble-nav" data-subject="current" aria-selected="true" role="tab" tabindex="0" aria-controls="topicList" aria-label="Current Affairs"><i class="fa-solid fa-globe"></i>Current</button>
  <button class="bubble-nav" data-subject="math" aria-selected="false" role="tab" tabindex="-1" aria-controls="topicList" aria-label="Math"><i class="fa-solid fa-square-root-variable"></i>Math</button>
  <button class="bubble-nav" data-subject="english" aria-selected="false" role="tab" tabindex="-1" aria-controls="topicList" aria-label="English Grammar"><i class="fa-solid fa-book-open"></i>English</button>
  <button class="bubble-nav" data-subject="computer" aria-selected="false" role="tab" tabindex="-1" aria-controls="topicList" aria-label="Computer"><i class="fa-solid fa-laptop-code"></i>Computer</button>
</footer>

<script src="https://kit.fontawesome.com/a81368914c.js" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<script>
(() => {
  // Initial empty data to be replaced by CSV
  let data = {
    current: {
      name: "Current Affairs",
      topics: {}
    },
    math: {
      name: "Math",
      topics: {}
    },
    english: {
      name: "English Grammar",
      topics: {}
    },
    computer: {
      name: "Computer",
      topics: {}
    }
  };

  let currentSubjectKey = 'current';
  let currentTopicKey = null;
  let searchActive = false;
  let currentAffairsIndex = 0;
  let currentAffairsTimerId = null;

  const topicListEl = document.getElementById('topicList');
  const readingPageEl = document.getElementById('readingPage');
  const readingContentEl = document.getElementById('readingContent');
  const appHeaderEl = document.getElementById('appHeader');
  const searchToggleBtn = document.getElementById('searchToggle');
  const searchBarEl = document.getElementById('searchBar');
  const searchInputEl = document.getElementById('searchInput');
  const navButtons = document.querySelectorAll('.bubble-nav');
  const backToTopicsBtn = document.getElementById('backToTopics');

  // Function to reset data from CSV array of objects
  function loadDataFromCSV(rows) {
    // Reset data
    data = {
      current: {name:"Current Affairs", topics:{}},
      math: {name:"Math", topics:{}},
      english: {name:"English Grammar", topics:{}},
      computer: {name:"Computer", topics:{}}
    };
    rows.forEach(row => {
      const subject = row.subject.toLowerCase();
      if (!data[subject]) {
        // If unknown subject, add it dynamically
        data[subject] = {name: row.subject, topics:{}};
      }
      data[subject].topics[row.topicKey] = {
        title: row.title,
        description: row.description,
        detailed: row.detailed,
        date: row.date,
        content: row.content
      };
    });
  }

  function setActiveNav(subjectKey) {
    navButtons.forEach(btn => {
      btn.classList.toggle('active', btn.dataset.subject === subjectKey);
      btn.setAttribute('aria-selected', btn.dataset.subject === subjectKey ? 'true' : 'false');
      btn.tabIndex = btn.dataset.subject === subjectKey ? 0 : -1;
    });
  }

  function showTopicList() {
    readingPageEl.style.display = 'none';
    topicListEl.style.display = 'block';
    appHeaderEl.textContent = data[currentSubjectKey].name;
    readingPageEl.scrollTop = 0;
    topicListEl.scrollTop = 0;
  }

  function showReadingPage() {
    topicListEl.style.display = 'none';
    readingPageEl.style.display = 'block';
    readingPageEl.focus();
    topicListEl.scrollTop = 0;
    readingPageEl.scrollTop = 0;
  }

  function clearSearch() {
    searchInputEl.value = '';
    searchBarEl.style.display = 'none';
    searchActive = false;
  }

  function renderTopicList(subjectKey, filter = '') {
    topicListEl.innerHTML = '';
    const subject = data[subjectKey];
    if(!subject) return;
    const topics = subject.topics;
    const keys = Object.keys(topics);
    const filterLower = filter.toLowerCase();

    const filteredKeys = filter.trim() === '' ? keys : keys.filter(k => {
      const t = topics[k];
      return t.title.toLowerCase().includes(filterLower)
        || t.description.toLowerCase().includes(filterLower)
        || (t.detailed && t.detailed.toLowerCase().includes(filterLower));
    });

    if(filteredKeys.length === 0) {
      const li = document.createElement('li');
      li.className = 'no-result';
      li.textContent = 'No topics found.';
      topicListEl.appendChild(li);
      return;
    }

    filteredKeys.forEach(key => {
      const topic = topics[key];
      const li = document.createElement('li');
      li.tabIndex = 0;
      li.className = 'topic-item';
      const iconClass = {
        current: 'fa-globe',
        math: 'fa-square-root-variable',
        english: 'fa-book-open',
        computer: 'fa-laptop-code'
      };
      const subjectIcon = iconClass[currentSubjectKey] || 'fa-circle';
      li.innerHTML = `<i class="fa-solid ${subjectIcon}"></i> ${topic.title}`;
      li.onclick = () => selectTopic(key);
      li.onkeypress = e => {
        if(e.key === "Enter" || e.key === " ") {
          selectTopic(key);
        }
      };
      topicListEl.appendChild(li);
    });
  }

  function selectTopic(topicKey) {
    const subject = data[currentSubjectKey];
    if(!subject) return;
    const topic = subject.topics[topicKey];
    if(!topic) return;
    currentTopicKey = topicKey;

    appHeaderEl.textContent = `${subject.name} - ${topic.title}`;
    readingContentEl.innerHTML = `
      <h2>${topic.title}</h2>
      <p><em>${topic.description}</em></p>
      ${topic.detailed || ''}
    `;
    showReadingPage();
    clearSearch();
  }

  function startCurrentAffairsCarousel() {
    const keys = Object.keys(data.current.topics);
    if(keys.length === 0) return;
    currentAffairsIndex = 0;
    renderCurrentAffairs(keys[currentAffairsIndex]);

    if(currentAffairsTimerId) clearInterval(currentAffairsTimerId);
    currentAffairsTimerId = setInterval(() => {
      currentAffairsIndex++;
      if(currentAffairsIndex >= keys.length) currentAffairsIndex = 0;
      renderCurrentAffairs(keys[currentAffairsIndex]);
    }, 15000);
  }

  function renderCurrentAffairs(key) {
    const topic = data.current.topics[key];
    if(!topic) return;
    currentTopicKey = null;
    appHeaderEl.textContent = `Current Affairs - ${topic.title}`;
    readingContentEl.innerHTML = `
      <div class='current-affairs-carousel'>
        <div class='carousel-title'>${topic.title}</div>
        <div class='carousel-date'>${topic.date || ''}</div>
        <div class='carousel-content'>${topic.content}</div>
        ${topic.detailed || ''}
      </div>
    `;
    showReadingPage();
  }

  function stopCurrentAffairsCarousel() {
    if(currentAffairsTimerId) {
      clearInterval(currentAffairsTimerId);
      currentAffairsTimerId = null;
    }
  }

  function selectSubject(subjectKey) {
    if(currentSubjectKey === subjectKey) return;
    currentSubjectKey = subjectKey;
    currentTopicKey = null;
    clearSearch();
    setActiveNav(subjectKey);

    if(subjectKey === 'current') {
      startCurrentAffairsCarousel();
    } else {
      stopCurrentAffairsCarousel();
      appHeaderEl.textContent = data[subjectKey].name;
      renderTopicList(subjectKey);
      showTopicList();
    }
  }

  function toggleSearch() {
    if(searchActive) {
      clearSearch();
      if(currentSubjectKey === 'current') {
        startCurrentAffairsCarousel();
      } else {
        renderTopicList(currentSubjectKey);
        showTopicList();
      }
    } else if(currentSubjectKey) {
      if(currentSubjectKey === 'current') stopCurrentAffairsCarousel();
      searchBarEl.style.display = 'block';
      searchInputEl.focus();
      searchActive = true;
    }
  }

  function onSearchInput() {
    const query = searchInputEl.value.trim();
    if(currentSubjectKey === 'current') {
      const filteredKeys = Object.keys(data.current.topics).filter(k => {
        const t = data.current.topics[k];
        const qLower = query.toLowerCase();
        return (t.title.toLowerCase().includes(qLower) || t.description.toLowerCase().includes(qLower) || t.content.toLowerCase().includes(qLower));
      });

      if(filteredKeys.length > 0) {
        stopCurrentAffairsCarousel();
        topicListEl.innerHTML = '';
        filteredKeys.forEach(key => {
          const topic = data.current.topics[key];
          const li = document.createElement('li');
          li.tabIndex = 0;
          li.className = 'topic-item';
          li.innerHTML = '<i class="fa-solid fa-globe"></i> ' + topic.title;
          li.onclick = () => selectCurrentAffairsTopic(key);
          li.onkeypress = e => {
            if(e.key === "Enter" || e.key === " ") selectCurrentAffairsTopic(key);
          };
          topicListEl.appendChild(li);
        });
        showTopicList();
        readingPageEl.style.display = 'none';
        appHeaderEl.textContent = `Search results for "${query}"`;
      } else {
        topicListEl.innerHTML = '<li class="no-result">No results found.</li>';
        showTopicList();
        readingPageEl.style.display = 'none';
        appHeaderEl.textContent = `Search results for "${query}"`;
      }
    } else {
      renderTopicList(currentSubjectKey, query);
      showTopicList();
      readingPageEl.style.display = 'none';
      appHeaderEl.textContent = query ? `Search results for "${query}"` : data[currentSubjectKey].name;
    }
  }

  function selectCurrentAffairsTopic(topicKey) {
    const topic = data.current.topics[topicKey];
    if(!topic) return;
    currentTopicKey = topicKey;
    appHeaderEl.textContent = `Current Affairs - ${topic.title}`;
    readingContentEl.innerHTML = `
      <h2>${topic.title}</h2>
      <p><em>${topic.description}</em></p>
      <p>${topic.content}</p>
      ${topic.detailed || ''}
    `;
    showReadingPage();
    clearSearch();
  }

  // CSV Load UI interactions
  const loadFileBtn = document.getElementById('loadFileBtn');
  const fileInput = document.getElementById('fileInput');

  loadFileBtn.addEventListener('click', () => fileInput.click());

  fileInput.addEventListener('change', e => {
    const file = e.target.files[0];
    if (file) {
      Papa.parse(file, {
        header: true,
        skipEmptyLines: true,
        complete: (results) => {
          loadDataFromCSV(results.data);
          // Refresh UI with loaded data
          setActiveNav(currentSubjectKey);
          if (currentSubjectKey === 'current') {
            startCurrentAffairsCarousel();
          } else {
            renderTopicList(currentSubjectKey);
            showTopicList();
          }
        },
        error: (err) => {
          alert("Error parsing CSV: " + err.message);
        }
      });
    }
  });

  function loadDataFromCSV(rows) {
    // Reset data to empty structure
    data = {
      current: {name:"Current Affairs", topics:{}},
      math: {name:"Math", topics:{}},
      english: {name:"English Grammar", topics:{}},
      computer: {name:"Computer", topics:{}}
    };
    rows.forEach(row => {
      const subject = row.subject.toLowerCase().trim();
      if (!data[subject]) {
        data[subject] = {name: row.subject, topics:{}};
      }
      const key = row.topicKey || `topic${Object.keys(data[subject].topics).length + 1}`;
      data[subject].topics[key] = {
        title: row.title || "",
        description: row.description || "",
        detailed: row.detailed || "",
        date: row.date || "",
        content: row.content || ""
      };
    });
  }

  // Nav, search, topic rendering etc. (as before, refactored to use current data object)

  navButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      selectSubject(btn.dataset.subject);
    });
    btn.addEventListener('keydown', e => {
      if(e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        selectSubject(btn.dataset.subject);
      }
    });
  });

  searchToggleBtn.addEventListener('click', toggleSearch);
  searchInputEl.addEventListener('input', onSearchInput);
  backToTopicsBtn.addEventListener('click', () => {
    clearSearch();
    if(currentSubjectKey === 'current') {
      startCurrentAffairsCarousel();
    } else {
      appHeaderEl.textContent = data[currentSubjectKey].name;
      renderTopicList(currentSubjectKey);
      showTopicList();
    }
  });

  window.addEventListener('load', () => {
    setActiveNav(currentSubjectKey);
    if(currentSubjectKey === 'current') {
      startCurrentAffairsCarousel();
    } else {
      renderTopicList(currentSubjectKey);
      showTopicList();
    }
  });
})();
</script>
</body>
</html>
